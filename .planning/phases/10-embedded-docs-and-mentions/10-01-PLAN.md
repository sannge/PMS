---
phase: 10-embedded-docs-and-mentions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - electron-app/src/renderer/contexts/knowledge-base-context.tsx
  - electron-app/src/renderer/components/knowledge/embedded-docs-tab.tsx
  - electron-app/src/renderer/components/knowledge/knowledge-sidebar.tsx
  - electron-app/src/renderer/pages/applications/[id].tsx
  - electron-app/src/renderer/pages/projects/[id].tsx
autonomous: true

must_haves:
  truths:
    - "Application detail page has a 'Docs' tab alongside existing Projects/Archive tabs"
    - "Project detail page has a 'Docs' tab alongside existing content"
    - "Clicking the Docs tab shows a sidebar with folder tree and a content area, scoped to that application or project"
    - "Switching between Docs tab and other tabs does NOT bleed scope into the Notes screen's localStorage"
  artifacts:
    - path: "electron-app/src/renderer/components/knowledge/embedded-docs-tab.tsx"
      provides: "Reusable EmbeddedDocsTab component"
      min_lines: 30
    - path: "electron-app/src/renderer/contexts/knowledge-base-context.tsx"
      provides: "KnowledgeBaseProvider with fixedScope prop to disable localStorage persistence"
      contains: "fixedScope"
    - path: "electron-app/src/renderer/components/knowledge/knowledge-sidebar.tsx"
      provides: "Sidebar with hideScope prop for embedded mode"
      contains: "hideScope"
  key_links:
    - from: "electron-app/src/renderer/pages/applications/[id].tsx"
      to: "electron-app/src/renderer/components/knowledge/embedded-docs-tab.tsx"
      via: "EmbeddedDocsTab import and render in Docs tab"
      pattern: "EmbeddedDocsTab.*scope.*application"
    - from: "electron-app/src/renderer/pages/projects/[id].tsx"
      to: "electron-app/src/renderer/components/knowledge/embedded-docs-tab.tsx"
      via: "EmbeddedDocsTab import and render in Docs tab"
      pattern: "EmbeddedDocsTab.*scope.*project"
---

<objective>
Create a reusable EmbeddedDocsTab component and integrate it as a "Docs" tab in both Application and Project detail pages, providing the full knowledge base experience (folder tree sidebar + content area) scoped to the specific entity.

Purpose: Users can access and edit documents directly within Application and Project detail pages without switching to the Notes screen.
Output: EmbeddedDocsTab component, updated KnowledgeBaseProvider (fixedScope support), updated KnowledgeSidebar (hideScope support), and both detail pages with Docs tabs.
</objective>

<execution_context>
@C:\Users\samng\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\samng\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-embedded-docs-and-mentions/10-RESEARCH.md
@electron-app/src/renderer/contexts/knowledge-base-context.tsx
@electron-app/src/renderer/components/knowledge/knowledge-sidebar.tsx
@electron-app/src/renderer/pages/notes/index.tsx
@electron-app/src/renderer/pages/applications/[id].tsx
@electron-app/src/renderer/pages/projects/[id].tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add fixedScope to KnowledgeBaseProvider and hideScope to KnowledgeSidebar, then create EmbeddedDocsTab</name>
  <files>
    electron-app/src/renderer/contexts/knowledge-base-context.tsx
    electron-app/src/renderer/components/knowledge/knowledge-sidebar.tsx
    electron-app/src/renderer/components/knowledge/embedded-docs-tab.tsx
  </files>
  <action>
**1. Update KnowledgeBaseProvider (knowledge-base-context.tsx):**
- Add a `fixedScope?: boolean` prop to `KnowledgeBaseProviderProps`.
- When `fixedScope` is true:
  - Skip ALL localStorage persistence effects for scope (the `useEffect` that persists scope and scopeId to `kb-scope` / `kb-scope-id`). Sidebar collapsed and expanded folders can still persist since they're harmless.
  - Use `initialScope` and `initialScopeId` directly (ignore stored values).
  - Make `setScope` a no-op (or skip dispatching SET_SCOPE) since the scope is locked.
- When `fixedScope` is false or undefined, behavior is unchanged (backward compatible).
- Pass `fixedScope` through to the context value so children can read it.
- Add `fixedScope: boolean` to `KnowledgeBaseUIState` interface (default false) and `KnowledgeBaseContextValue`.

**2. Update KnowledgeSidebar (knowledge-sidebar.tsx):**
- Add an optional `hideScope?: boolean` prop to the component.
- When `hideScope` is true, do NOT render the `<ScopeFilter />` section.
- Everything else renders normally (search bar, folder tree, tag filter list).
- Alternative: read `fixedScope` from context instead of a prop -- either approach is fine, but prop is simpler since the sidebar already receives no props.

**3. Create EmbeddedDocsTab (embedded-docs-tab.tsx):**
- Create `electron-app/src/renderer/components/knowledge/embedded-docs-tab.tsx`.
- Interface: `EmbeddedDocsTabProps { scope: 'application' | 'project'; scopeId: string }`.
- The component wraps content in `<KnowledgeBaseProvider initialScope={scope} initialScopeId={scopeId} fixedScope={true}>`.
- Layout: `<div className="flex h-full">` containing `<KnowledgeSidebar hideScope />` and a `<main className="flex-1 flex flex-col min-h-0">` with the same placeholder as NotesPage (FileText icon + "Select a document to start editing").
- Use `h-full` on the outer div so it fills the parent container.
- Import and use existing components -- do NOT duplicate any sidebar or folder tree code.
  </action>
  <verify>
Run `cd electron-app && npx tsc --noEmit` -- should pass with zero errors.
Verify the new file exists: `ls electron-app/src/renderer/components/knowledge/embedded-docs-tab.tsx`.
  </verify>
  <done>
- KnowledgeBaseProvider accepts `fixedScope` prop and skips scope localStorage persistence when true.
- KnowledgeSidebar accepts `hideScope` prop and conditionally hides ScopeFilter.
- EmbeddedDocsTab component exists and composes KnowledgeBaseProvider + KnowledgeSidebar with fixed scope.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add "Docs" tab to Application and Project detail pages</name>
  <files>
    electron-app/src/renderer/pages/applications/[id].tsx
    electron-app/src/renderer/pages/projects/[id].tsx
  </files>
  <action>
**1. Application detail page (applications/[id].tsx):**
- The page currently has a `showArchive` boolean state toggling between Projects and Archive views (~line 458).
- Replace `showArchive: boolean` with `activeTab: 'projects' | 'archive' | 'docs'` state (useState, default 'projects').
- Update the tab toggle section (~lines 861-897) to add a third "Docs" tab button following the exact same styling pattern (relative px-3 py-2 text-xs font-medium, with underline indicator span).
- Map existing references: `showArchive` -> `activeTab === 'archive'`, `!showArchive` -> `activeTab === 'projects'`, `setShowArchive(true)` -> `setActiveTab('archive')`, `setShowArchive(false)` -> `setActiveTab('projects')`.
- In the content area below the tabs (~line 900), render based on activeTab:
  - `'projects'`: existing project list content
  - `'archive'`: existing ArchivedProjectsList content
  - `'docs'`: `<EmbeddedDocsTab scope="application" scopeId={applicationId} />`
- Import `EmbeddedDocsTab` from `@/components/knowledge/embedded-docs-tab`.
- The Docs tab content needs `h-full` or `flex-1 min-h-0` to fill the space properly. Wrap it in a container div if needed: `<div className="flex-1 min-h-0"><EmbeddedDocsTab ... /></div>`.
- Use lucide-react `FileText` icon next to "Docs" label in the tab button for visual consistency, similar to how Archive tab has an icon.

**2. Project detail page (projects/[id].tsx):**
- The page currently renders the Kanban board directly without tabs (~line 148 switch case 'kanban').
- Add tab state: `const [activeTab, setActiveTab] = useState<'board' | 'docs'>('board')`.
- Add a tab bar above the Kanban board area, following the same styling pattern as the Application detail page tabs.
- Tab 1: "Board" (or "Kanban") -- renders existing KanbanBoard content.
- Tab 2: "Docs" -- renders `<EmbeddedDocsTab scope="project" scopeId={projectId} />`.
- Import `EmbeddedDocsTab` from `@/components/knowledge/embedded-docs-tab`.
- Ensure the tab bar is placed within the page content area, not in the header.
- Ensure proper height management: Docs tab needs `flex-1 min-h-0` to fill available space.

**Important:** Both pages must lazy-render the EmbeddedDocsTab (only mount when activeTab is 'docs') to avoid creating unnecessary KnowledgeBaseProvider instances and TanStack Query subscriptions.
  </action>
  <verify>
Run `cd electron-app && npx tsc --noEmit` -- should pass with zero errors.
Visually confirm the tabs render correctly by searching for the tab button patterns in the modified files.
  </verify>
  <done>
- Application detail page has Projects / Archive / Docs tabs, Docs tab renders EmbeddedDocsTab scoped to the application.
- Project detail page has Board / Docs tabs, Docs tab renders EmbeddedDocsTab scoped to the project.
- Tab switching is smooth and only the active tab content is mounted.
  </done>
</task>

</tasks>

<verification>
1. `cd electron-app && npx tsc --noEmit` passes with zero errors.
2. `embedded-docs-tab.tsx` exists and imports KnowledgeBaseProvider with fixedScope.
3. `knowledge-base-context.tsx` has fixedScope prop that disables scope persistence.
4. `knowledge-sidebar.tsx` has hideScope prop that conditionally hides ScopeFilter.
5. Application detail page file contains 'Docs' tab button and EmbeddedDocsTab with scope="application".
6. Project detail page file contains 'Docs' tab button and EmbeddedDocsTab with scope="project".
</verification>

<success_criteria>
- TypeScript compiles without errors.
- Application detail page has a third "Docs" tab alongside Projects and Archive.
- Project detail page has a "Docs" tab alongside Board/Kanban.
- Docs tabs render the embedded knowledge base sidebar + content area scoped to the entity.
- Opening the Notes screen after viewing embedded docs does NOT show the wrong scope (fixedScope prevents localStorage bleed).
</success_criteria>

<output>
After completion, create `.planning/phases/10-embedded-docs-and-mentions/10-01-SUMMARY.md`
</output>
