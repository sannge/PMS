---
phase: 02.1-onenote-knowledge-tree-redesign
plan: 03
type: execute
wave: 2
depends_on: ["02.1-01"]
files_modified:
  - electron-app/src/renderer/components/knowledge/folder-tree.tsx
  - electron-app/src/renderer/components/knowledge/scope-filter.tsx
  - electron-app/src/renderer/components/knowledge/scope-picker-dialog.tsx
autonomous: true

must_haves:
  truths:
    - "FolderTree no longer references ScopePickerDialog"
    - "FolderTree infers scope from context (activeTab) instead of reading 'all' scope"
    - "scope-filter.tsx and scope-picker-dialog.tsx are deleted"
    - "Creating a document in the tree uses the scope inferred from the active tab"
  artifacts:
    - path: "electron-app/src/renderer/components/knowledge/folder-tree.tsx"
      provides: "FolderTree without ScopePickerDialog or 'all' scope references"
  key_links:
    - from: "folder-tree.tsx"
      to: "knowledge-base-context.tsx"
      via: "useKnowledgeBase scope/scopeId"
      pattern: "useKnowledgeBase"
---

<objective>
Remove the old scope-filter and scope-picker-dialog components, and update FolderTree to work without the 'all' scope. Scope is now always inferred from the active tab.

Purpose: Clean up the old dropdown-based scope selection components. The user explicitly said "No backward compatibility needed. Old scope-filter components can be removed outright."
Output: Cleaned FolderTree, deleted scope-filter.tsx and scope-picker-dialog.tsx.
</objective>

<execution_context>
@C:\Users\samng\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\samng\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/02.1-onenote-knowledge-tree-redesign/02.1-CONTEXT.md
@.planning/phases/02.1-onenote-knowledge-tree-redesign/02.1-01-SUMMARY.md
@electron-app/src/renderer/components/knowledge/folder-tree.tsx
@electron-app/src/renderer/components/knowledge/scope-filter.tsx
@electron-app/src/renderer/components/knowledge/scope-picker-dialog.tsx
@electron-app/src/renderer/contexts/knowledge-base-context.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update FolderTree to remove 'all' scope and ScopePickerDialog</name>
  <files>
    electron-app/src/renderer/components/knowledge/folder-tree.tsx
  </files>
  <action>
    Refactor `folder-tree.tsx` to remove all references to the 'all' scope and ScopePickerDialog:

    1. **Remove ScopePickerDialog import:** Delete `import { ScopePickerDialog } from './scope-picker-dialog'`
    2. **Remove scope picker state:** Delete `scopePickerOpen`, `pendingFolderId`, `setScopePickerOpen`, `setPendingFolderId` state variables
    3. **Remove scope picker confirm handler:** Delete `handleScopePickerConfirm` callback entirely
    4. **Remove ScopePickerDialog JSX:** Delete the `<ScopePickerDialog ... />` at the bottom of the render

    5. **Update handleNewDocument:** Remove the `if (scope === 'all')` branch. Since scope is now always 'personal', 'application', or 'project' (never 'all'), the function simplifies to:
       ```typescript
       const handleNewDocument = useCallback(
         (folderId: string) => {
           handleCloseContextMenu()
           const resolvedScopeId = scope === 'personal' ? (userId ?? '') : (scopeId ?? '')
           createDocument.mutate(
             {
               title: 'Untitled',
               scope,
               scope_id: resolvedScopeId,
               folder_id: folderId,
             },
             {
               onSuccess: (data) => {
                 expandFolder(folderId)
                 selectDocument(data.id)
                 selectFolder(null)
                 setRenamingItemId(data.id)
                 setRenamingItemType('document')
               },
               onError: (error) => {
                 toast.error(error.message)
               },
             }
           )
         },
         [scope, scopeId, userId, createDocument, expandFolder, selectDocument, selectFolder, handleCloseContextMenu]
       )
       ```

    6. **Update handleCreateFirstDocument:** Remove the `if (scope === 'all')` branch. Same simplification:
       ```typescript
       const handleCreateFirstDocument = useCallback(() => {
         const resolvedScopeId = scope === 'personal' ? (userId ?? '') : (scopeId ?? '')
         createDocument.mutate(
           {
             title: 'Untitled',
             scope,
             scope_id: resolvedScopeId,
           },
           {
             onSuccess: (data) => {
               selectDocument(data.id)
               setRenamingItemId(data.id)
               setRenamingItemType('document')
             },
             onError: (error) => {
               toast.error(error.message)
             },
           }
         )
       }, [scope, scopeId, userId, createDocument, selectDocument])
       ```

    7. **Pass lock status to FolderTreeItem:** If FolderTreeItem now accepts `isLocked` and `lockHolderName` props (from Plan 02.1-02), pass them here. For now, pass `isLocked={false}` as placeholder — actual lock data integration will happen when the document list includes lock status.
  </action>
  <verify>
    1. `cd electron-app && npx tsc --noEmit --pretty 2>&1 | head -30` — zero errors
    2. `grep -n "ScopePickerDialog\|scope === 'all'\|scopePickerOpen" electron-app/src/renderer/components/knowledge/folder-tree.tsx` — no matches
  </verify>
  <done>
    FolderTree has no ScopePickerDialog, no 'all' scope branches, no scope picker state. Document creation always uses the current scope from context.
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete scope-filter.tsx and scope-picker-dialog.tsx</name>
  <files>
    electron-app/src/renderer/components/knowledge/scope-filter.tsx
    electron-app/src/renderer/components/knowledge/scope-picker-dialog.tsx
  </files>
  <action>
    Delete both files outright:
    1. `rm electron-app/src/renderer/components/knowledge/scope-filter.tsx`
    2. `rm electron-app/src/renderer/components/knowledge/scope-picker-dialog.tsx`

    Then verify no other files import them:
    - `grep -rn "scope-filter\|ScopeFilter" electron-app/src/renderer/` — should find zero matches (sidebar was already updated in Plan 02, folder-tree updated in Task 1 above)
    - `grep -rn "scope-picker-dialog\|ScopePickerDialog" electron-app/src/renderer/` — should find zero matches

    If any remaining imports are found, update those files to remove the dead imports.
  </action>
  <verify>
    1. Files do not exist: `ls electron-app/src/renderer/components/knowledge/scope-filter.tsx electron-app/src/renderer/components/knowledge/scope-picker-dialog.tsx 2>&1` — both should fail
    2. `grep -rn "scope-filter\|scope-picker-dialog\|ScopeFilter\|ScopePickerDialog" electron-app/src/renderer/` — zero matches
    3. `cd electron-app && npx tsc --noEmit --pretty 2>&1 | head -20` — zero errors
  </verify>
  <done>
    scope-filter.tsx and scope-picker-dialog.tsx are deleted. No remaining imports reference them. TypeScript compilation passes.
  </done>
</task>

</tasks>

<verification>
1. `cd electron-app && npx tsc --noEmit --pretty` — zero errors
2. No file named scope-filter.tsx or scope-picker-dialog.tsx exists
3. No import of ScopeFilter or ScopePickerDialog exists anywhere
4. FolderTree has no 'all' scope logic
</verification>

<success_criteria>
- FolderTree creates documents using scope from context (never 'all')
- ScopePickerDialog removed from FolderTree
- scope-filter.tsx and scope-picker-dialog.tsx deleted
- No dangling imports remain
- Zero TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-onenote-knowledge-tree-redesign/02.1-03-SUMMARY.md`
</output>
