---
phase: 02.1-onenote-knowledge-tree-redesign
plan: 12
type: execute
wave: 2
depends_on: ["02.1-06"]
files_modified:
  - electron-app/src/renderer/components/knowledge/folder-tree.tsx
  - electron-app/src/renderer/components/knowledge/application-tree.tsx
  - electron-app/src/renderer/components/knowledge/folder-tree-item.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Skeleton loading replaces spinners throughout the knowledge tree"
    - "Loading state appears as skeleton rows, not circular spinners"
    - "Background refresh shows subtle indicator, not full skeleton"
  artifacts:
    - path: "electron-app/src/renderer/components/knowledge/folder-tree.tsx"
      provides: "Tree with skeleton loading states"
  key_links:
    - from: "folder-tree.tsx"
      to: "FolderTreeSkeleton"
      via: "Loading state render"
      pattern: "isLoading.*Skeleton"
---

<objective>
Fix loading states: user wants skeleton loading instead of spinners throughout the knowledge tree.

Purpose: Skeleton loading provides better perceived performance and visual continuity than spinning loaders.

Output: All loading states in the knowledge tree use skeleton patterns instead of Loader2 spinners.
</objective>

<execution_context>
@C:\Users\samng\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\samng\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@electron-app/src/renderer/components/knowledge/folder-tree.tsx
@electron-app/src/renderer/components/knowledge/application-tree.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace Loader2 spinners with skeleton in folder-tree.tsx</name>
  <files>electron-app/src/renderer/components/knowledge/folder-tree.tsx</files>
  <action>
Current code uses:
1. FolderTreeSkeleton for initial loading (good - already skeleton)
2. Loader2 spinner for background refresh indicator

The background refresh indicator is fine as a subtle spinner since it's not blocking content.

Check if there are any other Loader2 usages that should be skeletons:

1. The "Create your first document" button uses Loader2 during creation - this is fine (button loading state)

2. The background refresh indicator:
   ```tsx
   {isFoldersFetching && !isFoldersLoading && (
     <div className="flex items-center justify-end px-2 pb-0.5">
       <Loader2 className="h-3 w-3 animate-spin text-muted-foreground" />
     </div>
   )}
   ```
   This is already subtle and acceptable. The user complaint is about blocking spinners, not background indicators.

Main action: Verify FolderTreeSkeleton is being used correctly for initial load:
```tsx
if (isLoading) {
  return <FolderTreeSkeleton />
}
```

If needed, enhance the FolderTreeSkeleton to look more like the actual tree:
```tsx
function FolderTreeSkeleton(): JSX.Element {
  return (
    <div className="p-2 space-y-1">
      {/* Folder skeleton */}
      <div className="flex items-center gap-2 px-2 py-1.5">
        <div className="h-4 w-4 rounded bg-muted animate-pulse" />
        <div className="h-4 flex-1 rounded bg-muted animate-pulse" style={{ maxWidth: '60%' }} />
      </div>
      {/* Nested document skeletons */}
      <div className="flex items-center gap-2 px-2 py-1.5 ml-4">
        <div className="h-4 w-4 rounded bg-muted animate-pulse" />
        <div className="h-4 flex-1 rounded bg-muted animate-pulse" style={{ maxWidth: '70%' }} />
      </div>
      <div className="flex items-center gap-2 px-2 py-1.5 ml-4">
        <div className="h-4 w-4 rounded bg-muted animate-pulse" />
        <div className="h-4 flex-1 rounded bg-muted animate-pulse" style={{ maxWidth: '50%' }} />
      </div>
      {/* Another folder */}
      <div className="flex items-center gap-2 px-2 py-1.5">
        <div className="h-4 w-4 rounded bg-muted animate-pulse" />
        <div className="h-4 flex-1 rounded bg-muted animate-pulse" style={{ maxWidth: '55%' }} />
      </div>
    </div>
  )
}
```

The skeleton should visually match the tree item layout (icon + text with proper indentation).
  </action>
  <verify>
Run `npm run typecheck` - zero errors.
Grep for "Loader2" in folder-tree.tsx - should only find it in acceptable places (button, background indicator).
Grep for "FolderTreeSkeleton" - should find it used for isLoading state.
  </verify>
  <done>
FolderTree uses skeleton loading for initial load, subtle spinner only for background refresh.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace spinner with skeleton in ApplicationTree ProjectSection</name>
  <files>electron-app/src/renderer/components/knowledge/application-tree.tsx</files>
  <action>
The main issue: ProjectSection shows a Loader2 spinner when expanding:
```tsx
{isLoading ? (
  <div className="flex items-center gap-1.5 px-2 py-1.5 text-xs text-muted-foreground">
    <Loader2 className="h-3 w-3 animate-spin" />
    <span>Loading...</span>
  </div>
) : (
  ...
)}
```

Replace with a skeleton that matches the tree structure:
```tsx
{isLoading ? (
  <div className="pl-4 space-y-1 py-1">
    {/* Document skeleton rows */}
    <div className="flex items-center gap-2 px-2 py-1.5">
      <div className="h-3.5 w-3.5 rounded bg-muted animate-pulse" />
      <div className="h-3.5 flex-1 rounded bg-muted animate-pulse" style={{ maxWidth: '65%' }} />
    </div>
    <div className="flex items-center gap-2 px-2 py-1.5">
      <div className="h-3.5 w-3.5 rounded bg-muted animate-pulse" />
      <div className="h-3.5 flex-1 rounded bg-muted animate-pulse" style={{ maxWidth: '80%' }} />
    </div>
    <div className="flex items-center gap-2 px-2 py-1.5">
      <div className="h-3.5 w-3.5 rounded bg-muted animate-pulse" />
      <div className="h-3.5 flex-1 rounded bg-muted animate-pulse" style={{ maxWidth: '50%' }} />
    </div>
  </div>
) : (
  ...
)}
```

Also check the main ApplicationTree loading state:
```tsx
if (isLoading) {
  return <TreeSkeleton />
}
```

Ensure TreeSkeleton matches the visual structure (already exists, verify it's good).

Optional: Create a reusable TreeItemSkeleton component:
```tsx
function TreeItemSkeleton({ depth = 0 }: { depth?: number }): JSX.Element {
  return (
    <div
      className="flex items-center gap-2 px-2 py-1.5"
      style={{ paddingLeft: depth * 16 + 8 }}
    >
      <div className="h-3.5 w-3.5 rounded bg-muted animate-pulse" />
      <div className="h-3.5 flex-1 rounded bg-muted animate-pulse" style={{ maxWidth: `${50 + Math.random() * 30}%` }} />
    </div>
  )
}
```
  </action>
  <verify>
Run `npm run typecheck` - zero errors.
Grep for "Loader2" in application-tree.tsx - should NOT find it in ProjectSection loading state.
The TreeSkeleton component should be used for initial load.
  </verify>
  <done>
ApplicationTree and ProjectSection use skeleton loading instead of spinners.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add inline skeleton for any remaining loading states</name>
  <files>electron-app/src/renderer/components/knowledge/folder-tree-item.tsx, electron-app/src/renderer/components/knowledge/knowledge-panel.tsx</files>
  <action>
Check folder-tree-item.tsx for any loading states that use spinners:
- The component receives props and renders - shouldn't have internal loading states
- If it has any Loader2 usage, replace with skeleton

Check knowledge-panel.tsx:
- Document loading in editor panel
- Currently shows empty state or document content

For editor loading, ensure there's a skeleton state when document is loading:
```tsx
// In InnerPanel / editor section
const { data: document, isLoading: isDocLoading } = useDocument(selectedDocumentId)

// Render
{selectedDocumentId ? (
  isDocLoading ? (
    <div className="flex-1 p-4">
      {/* Editor skeleton */}
      <div className="space-y-3">
        <div className="h-8 w-48 rounded bg-muted animate-pulse" /> {/* Title */}
        <div className="space-y-2">
          <div className="h-4 rounded bg-muted animate-pulse" style={{ width: '90%' }} />
          <div className="h-4 rounded bg-muted animate-pulse" style={{ width: '75%' }} />
          <div className="h-4 rounded bg-muted animate-pulse" style={{ width: '85%' }} />
          <div className="h-4 rounded bg-muted animate-pulse" style={{ width: '60%' }} />
        </div>
      </div>
    </div>
  ) : document ? (
    <DocumentEditor ... />
  ) : (
    <div className="flex-1 flex flex-col items-center justify-center text-muted-foreground gap-3">
      <FileText className="h-12 w-12 text-muted-foreground/30" />
      <p className="text-sm">Document not found</p>
    </div>
  )
) : (
  // Empty state
  ...
)}
```

This ensures the editor panel shows skeleton while document content is loading, not a spinner.
  </action>
  <verify>
Run `npm run typecheck` - zero errors.
Grep for "Loader2" across all knowledge components - should only find acceptable uses (buttons, background indicators).
  </verify>
  <done>
All knowledge tree loading states use skeleton patterns for consistent UX.
  </done>
</task>

</tasks>

<verification>
1. `cd electron-app && npm run typecheck` passes
2. Initial tree load shows skeleton, not spinner
3. Project section expand shows skeleton rows, not spinner
4. Document load in editor shows content skeleton
5. Loader2 only used for button states and subtle background indicators
</verification>

<success_criteria>
- Initial tree load shows skeleton matching tree structure
- Expanding a project section shows skeleton rows, not "Loading..." spinner
- Document loading shows content skeleton in editor panel
- All blocking loading states use skeletons
- Background refresh can still use subtle spinner (non-blocking)
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-onenote-knowledge-tree-redesign/02.1-12-SUMMARY.md`
</output>
