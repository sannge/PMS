# Phase 2.1: OneNote-Style Knowledge Tree Redesign - Context

**Gathered:** 2026-02-01
**Status:** Ready for planning

<domain>
## Phase Boundary

Replace the scope-filter dropdown approach with a OneNote-style tabbed notebook interface. The main Notes screen gets horizontal tabs (My Notes + one per Application that has docs), with each tab revealing a folder/document tree. Application and Project detail pages get a Knowledge tab with the same full-featured tree + inline editor. Scope is inferred from position in the tree, not selected via dropdown.

This phase redesigns Phase 2's sidebar UI and adds the Knowledge tab to detail pages (originally Phase 10's EMBED-01/EMBED-02). The existing folder tree component, context menus, CRUD hooks, and TanStack Query infrastructure from Phase 2 are reused — the change is structural (tabs instead of dropdown, unified vs filtered tree).

</domain>

<decisions>
## Implementation Decisions

### Tree Structure & Hierarchy
- **Horizontal tabs** across the top of the sidebar: "My Notes" first, then one tab per Application (in creation order)
- **One tab visible at a time** — selecting a tab shows only that section's tree
- **Tabs auto-appear** when first document is created for an application (via API, Knowledge tab, etc.)
- **Tabs auto-disappear** when all documents in that application are deleted
- **No manual '+' button** on the tab bar — tabs are auto-managed based on document existence
- **My Notes tab**: personal folders and docs, user creates whatever structure they want, unlimited nesting
- **Application tab** shows:
  - User-created folders (app-scoped) with unlimited nesting
  - Auto-generated project folders (one per project that has docs, project-scoped)
  - Subfolders inside project folders allowed (project-scoped, user-created)
  - Loose app-level docs (app-scoped, no folder)
- **No document counts** on folders or sections — clean names and icons only

### Scope Inference Behavior
- **My Notes tab**: everything is personal scope (scope=personal, scope_id=user_id)
- **App tab, app level**: folders/docs directly under the app tab are app-scoped (scope=application, scope_id=app_id)
- **App tab, project folder**: folders/docs inside a project folder are project-scoped (scope=project, scope_id=project_id)
- **App detail Knowledge tab**: shows ALL docs — app-scoped + all project folders with their docs
- **Drag-and-drop only within same scope**: cannot drag between My Notes ↔ App, between apps, or between app-level ↔ project-level within same app tab
- **No cross-scope moves at all** — reorder and nest within the same scope only

### App/Project Knowledge Tab
- **Application detail page** gets a "Knowledge" tab showing the **identical tree** as the App tab in the main Notes screen (same component, same data, same interactions)
- **Project detail page** gets a "Knowledge" tab showing **only that project's docs** (folders and docs scoped to that specific project)
- **Inline editor**: clicking a document opens the editor right there in the detail page, full editing capability
- **Full CRUD**: create, rename, delete folders and docs — same as the main Notes screen

### Notebook Visual Style
- **Modern flat tabs** — clean, no OneNote skeuomorphism. Subtle active indicator, fits existing app design system
- **OneNote page-list style tree** — items listed vertically with indentation for nesting, no explicit expand/collapse chevron arrows. Click to expand/collapse
- **Background highlight** for selected document (subtle background color)
- **Document name only** in tree — no timestamps or metadata, BUT show lock icon (if locked) and editing user's avatar/name logo
- **'+' button always visible** at top of tree for quick doc/folder creation, AND right-click context menu for folder-specific creation
- **Screen layout**: use frontend-design skill to follow best UI/UX practices (Claude's discretion on exact panel layout)
- **Search bar**: defaults to current tab, with a toggle to search across all tabs (global)

### Claude's Discretion
- Exact screen layout (two-panel vs three-panel) — use frontend-design skill for best UI/UX
- Tab bar styling details (colors, active indicator style, spacing)
- Tree indentation amounts and animation transitions
- Empty state design for tabs with no docs
- How project folders are visually distinguished from user-created folders within an app tab
- Search results presentation when in global mode

</decisions>

<specifics>
## Specific Ideas

- OneNote-style page list (not file explorer tree) — no chevron arrows, click item to expand
- Lock status and editing user shown inline next to document name in tree
- The Knowledge tab on detail pages should feel like part of the detail page, not a navigation away — inline editing is key
- Application Knowledge tab is a superset: shows everything (app-level + all projects), while Project Knowledge tab is a subset (only that project's docs)

</specifics>

<deferred>
## Deferred Ideas

- **File attachments (PDF, Excel, Word)** — upload non-editable files that appear in the tree with view-only rendering. Future phase alongside or after Phase 7 (Images)
- **Cross-scope document moving** — ability to move docs between scopes (e.g., personal → app) is explicitly excluded. Could be a future enhancement
- **Manual tab management** — ability to manually add/pin/reorder tabs. Currently auto-managed only

</deferred>

---

*Phase: 02.1-onenote-knowledge-tree-redesign*
*Context gathered: 2026-02-01*
