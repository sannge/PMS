---
phase: 02.1-onenote-knowledge-tree-redesign
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - electron-app/src/renderer/components/knowledge/knowledge-panel.tsx
  - electron-app/src/renderer/pages/notes/index.tsx
  - electron-app/src/renderer/pages/applications/[id].tsx
  - electron-app/src/renderer/components/knowledge/editor-styles.css
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Knowledge panel uses full available screen width in Application detail page"
    - "Editor uses full available space without unwanted blue border"
    - "Panel width is resizable by dragging the edge"
    - "Editor has clean styling without debug borders"
  artifacts:
    - path: "electron-app/src/renderer/components/knowledge/knowledge-panel.tsx"
      provides: "Two-panel layout with resizable divider"
    - path: "electron-app/src/renderer/components/knowledge/editor-styles.css"
      provides: "Editor styles without debug borders"
  key_links:
    - from: "knowledge-panel.tsx"
      to: "ResizeHandle"
      via: "Draggable divider component"
      pattern: "onMouseDown.*resize"
---

<objective>
Fix layout gaps: Application Knowledge panel using half screen, editor only 1/4 of screen with unwanted blue border, no resizable panels.

Purpose: Knowledge panels should use full available space with resizable tree/editor split like OneNote.

Output: Full-width knowledge panels with draggable resize handle between tree and editor.
</objective>

<execution_context>
@C:\Users\samng\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\samng\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@electron-app/src/renderer/components/knowledge/knowledge-panel.tsx
@electron-app/src/renderer/pages/applications/[id].tsx
@electron-app/src/renderer/components/knowledge/editor-styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make KnowledgePanel use full available width and add resizable divider</name>
  <files>electron-app/src/renderer/components/knowledge/knowledge-panel.tsx</files>
  <action>
Current issues:
1. Tree panel has fixed w-64 (256px) width
2. No resize capability
3. Border styling may be causing unwanted appearance

Fix:
1. Add resize state and handlers:
   ```tsx
   const [treeWidth, setTreeWidth] = useState(280) // Reasonable default
   const isResizingRef = useRef(false)
   const minWidth = 200
   const maxWidth = 500
   ```

2. Add mouse handlers for resize:
   ```tsx
   const handleMouseDown = useCallback((e: React.MouseEvent) => {
     e.preventDefault()
     isResizingRef.current = true
     document.addEventListener('mousemove', handleMouseMove)
     document.addEventListener('mouseup', handleMouseUp)
   }, [])

   const handleMouseMove = useCallback((e: MouseEvent) => {
     if (!isResizingRef.current) return
     const newWidth = Math.max(minWidth, Math.min(maxWidth, e.clientX))
     setTreeWidth(newWidth)
   }, [])

   const handleMouseUp = useCallback(() => {
     isResizingRef.current = false
     document.removeEventListener('mousemove', handleMouseMove)
     document.removeEventListener('mouseup', handleMouseUp)
   }, [])
   ```

3. Add cleanup on unmount:
   ```tsx
   useEffect(() => {
     return () => {
       document.removeEventListener('mousemove', handleMouseMove)
       document.removeEventListener('mouseup', handleMouseUp)
     }
   }, [handleMouseMove, handleMouseUp])
   ```

4. Update tree panel div:
   - Replace `w-64` with `style={{ width: treeWidth }}`
   - Keep flex-shrink-0

5. Add resize handle between tree and editor:
   ```tsx
   {/* Resize handle */}
   <div
     className="w-1 cursor-col-resize bg-border hover:bg-primary/50 transition-colors flex-shrink-0"
     onMouseDown={handleMouseDown}
   />
   ```

6. Remove any fixed width constraints from the outer container
7. Use className prop properly so parent can pass flex-1 or h-full

The layout structure should be:
```tsx
<div className={cn('flex h-full overflow-hidden', className)}>
  {/* Tree panel */}
  <div style={{ width: treeWidth }} className="flex-shrink-0 flex flex-col border-r border-border bg-sidebar">
    ...
  </div>

  {/* Resize handle */}
  <div className="w-1 cursor-col-resize ..." onMouseDown={handleMouseDown} />

  {/* Editor panel */}
  <div className="flex-1 flex flex-col min-w-0">
    ...
  </div>
</div>
```
  </action>
  <verify>
Run `npm run typecheck` - zero errors.
Grep for "cursor-col-resize" in knowledge-panel.tsx - should find the resize handle.
  </verify>
  <done>
KnowledgePanel has draggable resize handle between tree and editor panels.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove unwanted border styling from editor</name>
  <files>electron-app/src/renderer/components/knowledge/editor-styles.css, electron-app/src/renderer/components/knowledge/document-editor.tsx</files>
  <action>
User reported "unwanted blue border" on editor. This could be:
1. Debug border in CSS
2. Focus ring styling
3. Container border

Investigation and fix:
1. Check editor-styles.css for any border-related debug styles:
   - Look for `border: 1px solid blue` or similar debug borders
   - Look for any `.ProseMirror` border overrides that aren't focus-related
   - Remove any debug borders

2. Check document-editor.tsx:
   - The outer div has `border rounded-lg` which is appropriate
   - Verify the border color is `border-border` not a blue color
   - If there's a blue focus ring, ensure it only appears on focus, not always

3. The editor content area (EditorContent) should NOT have its own border
   - Borders should only be on the outer container

4. Remove or fix any CSS that adds unwanted borders:
   ```css
   /* Remove if present */
   .ProseMirror {
     border: none; /* Explicitly remove if inherited */
     outline: none;
   }

   .ProseMirror:focus {
     outline: none; /* Focus is handled by container */
   }
   ```

5. For KnowledgePanel, the editor container should have minimal styling:
   - No additional border (it's inside the panel which has border)
   - Remove `border rounded-lg` from DocumentEditor wrapper in KnowledgePanel if the panel itself provides the border
  </action>
  <verify>
Grep for "border.*blue" in editor-styles.css and document-editor.tsx - should find nothing.
Grep for "debug" in CSS files - should find nothing related to borders.
  </verify>
  <done>
Editor displays without unwanted blue border, with clean visual appearance.
  </done>
</task>

<task type="auto">
  <name>Task 3: Ensure Application detail passes full-width styling to KnowledgePanel</name>
  <files>electron-app/src/renderer/pages/applications/[id].tsx</files>
  <action>
The KnowledgePanel is rendered with `className="flex-1"` but the parent container might be constraining it.

Check and fix the Application detail page:
1. Find where KnowledgePanel is rendered (around line 1083)
2. Ensure the parent container uses full width:
   ```tsx
   ) : (
     <KnowledgePanel
       scope="application"
       scopeId={applicationId}
       showProjectFolders
       className="flex-1 h-full"
     />
   )
   ```

3. Verify the parent `<div className="space-y-3 flex-1 flex flex-col min-h-0">` allows full width
   - The `space-y-3` is fine
   - `flex-1` and `flex flex-col` should allow full expansion

4. If the Projects/Archive/Knowledge content area has any max-width constraints, remove them for the Knowledge view

5. Similarly check and fix Notes page (notes/index.tsx):
   - The main content area should be `flex-1` taking remaining width after sidebar
   - No max-width constraints
  </action>
  <verify>
Run `npm run typecheck` - zero errors.
Verify KnowledgePanel has `className="flex-1"` or similar full-width class.
  </verify>
  <done>
Knowledge panels use full available screen width in both Application detail and Notes page.
  </done>
</task>

</tasks>

<verification>
1. `cd electron-app && npm run typecheck` passes
2. KnowledgePanel has resize handle (grep for cursor-col-resize)
3. No debug borders in CSS (grep for border.*blue or debug)
4. Application detail passes full-width className to KnowledgePanel
</verification>

<success_criteria>
- Knowledge panel in Application detail uses full screen width (not half)
- Tree panel is resizable by dragging the divider edge
- Editor area has no unwanted blue border
- Resize works smoothly with min/max constraints (200px - 500px)
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-onenote-knowledge-tree-redesign/02.1-07-SUMMARY.md`
</output>
