---
phase: 03-rich-text-editor-core
plan: 04
type: execute
wave: 4
depends_on: ["03-03"]
files_modified:
  - electron-app/src/renderer/components/knowledge/editor-toolbar.tsx
  - electron-app/src/renderer/components/knowledge/document-editor.tsx
autonomous: true

must_haves:
  truths:
    - "User can insert a clickable link via a link dialog in the toolbar"
    - "User can select font family from a dropdown with 10 font options"
    - "User can select font size from a dropdown with 4 size options"
    - "User can change text foreground color from a color picker popover"
    - "Word count displays at the bottom of the editor"
    - "Character count displays at the bottom of the editor"
  artifacts:
    - path: "electron-app/src/renderer/components/knowledge/editor-toolbar.tsx"
      provides: "Link dialog, font family dropdown, font size dropdown added to toolbar"
    - path: "electron-app/src/renderer/components/knowledge/document-editor.tsx"
      provides: "EditorStatusBar component rendering word count and character count"
  key_links:
    - from: "editor-toolbar.tsx link dialog"
      to: "editor.chain().focus().setLink({ href }).run()"
      via: "applyLink handler"
      pattern: "setLink"
    - from: "editor-toolbar.tsx font family dropdown"
      to: "editor.chain().focus().setFontFamily(value).run()"
      via: "onClick handler"
      pattern: "setFontFamily"
    - from: "document-editor.tsx status bar"
      to: "editor.storage.characterCount"
      via: "words() and characters() methods"
      pattern: "characterCount"
---

<objective>
Add link insertion dialog, font family and font size dropdowns, and word count status bar to complete the editor toolbar and status bar.

Purpose: Covers requirements EDIT-07 (links), EDIT-08 (font family + font size), EDIT-09 (text color -- already partially done in plan 01 via Color popover, this plan adds font controls), and EDIT-14 (word count). This is the final plan for Phase 3, completing all editor features.

Output: Full-featured editor toolbar with all controls, plus word/character count in a status bar at the bottom.
</objective>

<execution_context>
@C:\Users\samng\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\samng\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-rich-text-editor-core/03-RESEARCH.md
@.planning/phases/03-rich-text-editor-core/03-03-SUMMARY.md
@electron-app/src/renderer/components/knowledge/editor-toolbar.tsx
@electron-app/src/renderer/components/knowledge/document-editor.tsx
@electron-app/src/renderer/components/knowledge/editor-extensions.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add link dialog, font family dropdown, and font size dropdown to toolbar</name>
  <files>electron-app/src/renderer/components/knowledge/editor-toolbar.tsx</files>
  <action>
Read the existing `editor-toolbar.tsx`. Add three new toolbar sections.

**Section 1: Link Insert/Edit Dialog**

Add a Link button to the toolbar (in the insert group, near the table button):
- `Link` icon (from lucide-react, import as `LinkIcon`), title "Insert Link"
- Active when `editor.isActive('link')`
- On click, open an inline link dialog (same pattern as RichTextEditor.tsx lines 824-867)

Link dialog implementation:
- State: `linkDialogOpen` (boolean), `linkUrl` (string), `linkInputRef` (ref to input for auto-focus)
- Position: `absolute left-0 right-0 top-full z-50 border-b bg-background shadow-md p-3`
- Layout: flex row with LinkIcon, text input, "Apply" button, conditional "Remove" button (when link active), "Cancel" button
- Input: type="url", placeholder "https://example.com", onKeyDown Enter applies, Escape cancels
- Apply handler (`applyLink`): trim URL, auto-prepend `https://` if no protocol, call `editor.chain().focus().extendMarkRange('link').setLink({ href: url }).run()`. If URL empty, unset link.
- Remove handler: `editor.chain().focus().extendMarkRange('link').unsetLink().run()`
- Open handler: pre-fill with existing link href via `editor.getAttributes('link').href || ''`, then auto-focus input

Import additional icon: `Link as LinkIcon`.

**Section 2: Font Size Dropdown** (new group after the color/highlight group)

Use Popover:
- Trigger: `Type` icon + current size label + `ChevronDown`. Show "Normal" if no fontSize set.
- Content: 4 buttons (Small 0.875rem, Normal 1rem, Large 1.25rem, Heading 1.5rem)
- Each button styled at its own font-size, active state `bg-primary/10 text-primary font-medium`
- Handler: `editor.chain().focus().setMark('textStyle', { fontSize: value }).run()`
- Active detection: `editor.getAttributes('textStyle').fontSize` matches value, or no fontSize and value is '1rem'

Import `FONT_SIZES` from `./editor-extensions`.
Import `Type` icon from lucide-react.

**Section 3: Font Family Dropdown** (same group as font size)

Use Popover:
- Trigger: current font family label (abbreviated) + `ChevronDown`. Show "Arial" if no fontFamily set.
- Content: scrollable list (max-h-48 overflow-y-auto) of 10 font family buttons
- Each button rendered in its own font-family via inline style
- Active detection: `editor.getAttributes('textStyle').fontFamily` matches value, or no fontFamily and value is DEFAULT_FONT_FAMILY
- Handler: `editor.chain().focus().setFontFamily(value).run()`. For default/inherit: `editor.chain().focus().unsetFontFamily().run()`

Import `FONT_FAMILIES, DEFAULT_FONT_FAMILY` from `./editor-extensions`.
  </action>
  <verify>
Run `cd electron-app && npx tsc --noEmit` to confirm no TypeScript errors.
Run `cd electron-app && npm run lint` to confirm no lint warnings.
  </verify>
  <done>Toolbar has link insert button with inline dialog (apply, remove, cancel), font size dropdown with 4 options, font family dropdown with 10 options. Link dialog auto-prepends https:// and supports keyboard shortcuts.</done>
</task>

<task type="auto">
  <name>Task 2: Add word count and character count status bar to DocumentEditor</name>
  <files>electron-app/src/renderer/components/knowledge/document-editor.tsx</files>
  <action>
Read the existing `document-editor.tsx`. Add an `EditorStatusBar` component and integrate it.

**EditorStatusBar component** (can be defined in the same file or exported):

```tsx
function EditorStatusBar({ editor }: { editor: Editor }) {
  const wordCount = editor.storage.characterCount?.words() ?? 0
  const charCount = editor.storage.characterCount?.characters() ?? 0

  return (
    <div className="flex items-center justify-between px-3 py-1.5 border-t text-xs text-muted-foreground bg-muted/20">
      <span>{wordCount} words</span>
      <span>{charCount} characters</span>
    </div>
  )
}
```

**Integration in DocumentEditor:**

Update the render to include the status bar at the bottom:

```tsx
<div className={cn('border border-input rounded-lg overflow-hidden bg-background flex flex-col', className)}>
  {!readOnly && <EditorToolbar editor={editor} />}
  <div className="flex-1 overflow-y-auto">
    <EditorContent editor={editor} />
  </div>
  <EditorStatusBar editor={editor} />
</div>
```

The status bar is always visible (even in readOnly mode) because word count is useful for readers too.

The CharacterCount extension was already configured in plan 01's extension factory, so `editor.storage.characterCount` is available. No additional extension setup needed.
  </action>
  <verify>
Run `cd electron-app && npx tsc --noEmit` to confirm no TypeScript errors.
Run `cd electron-app && npm run lint` to confirm no lint warnings.
  </verify>
  <done>Status bar at bottom of editor shows word count and character count. Updates reactively as user types. Visible in both edit and read-only modes.</done>
</task>

</tasks>

<verification>
1. `cd electron-app && npx tsc --noEmit` -- zero errors
2. `cd electron-app && npm run lint` -- zero warnings
3. Link button with dialog exists in toolbar
4. Font size dropdown with 4 options exists
5. Font family dropdown with 10 options exists
6. Word count and character count display at bottom of editor
7. ALL Phase 3 requirements met:
   - EDIT-01: Bold, italic, underline, strikethrough (plan 01)
   - EDIT-02: Headings H1-H6 (plan 02)
   - EDIT-03: Bullet lists, numbered lists, indentation (plan 02)
   - EDIT-04: Interactive checklists (plan 02)
   - EDIT-05: Tables with resizable columns (plan 03)
   - EDIT-06: Code blocks with syntax highlighting (plan 02)
   - EDIT-07: Links (this plan)
   - EDIT-08: Font family and font size (this plan)
   - EDIT-09: Text color (plan 01 color popover)
   - EDIT-14: Word count (this plan)
</verification>

<success_criteria>
- Link dialog allows inserting, editing, and removing links with auto-prepend https://
- Font size dropdown shows 4 options with visual preview
- Font family dropdown shows 10 options rendered in their own fonts
- Word count updates reactively at the bottom of the editor
- All 10 EDIT requirements for Phase 3 are met across plans 01-04
- Zero TypeScript errors, zero lint warnings
</success_criteria>

<output>
After completion, create `.planning/phases/03-rich-text-editor-core/03-04-SUMMARY.md`
</output>
