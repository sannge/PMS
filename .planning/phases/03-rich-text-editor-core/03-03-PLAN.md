---
phase: 03-rich-text-editor-core
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - electron-app/src/renderer/components/knowledge/editor-toolbar.tsx
autonomous: true

must_haves:
  truths:
    - "User can insert a table from the toolbar"
    - "User can add and remove rows and columns from table controls"
    - "Table columns are resizable by dragging"
    - "Table controls only appear when cursor is inside a table"
  artifacts:
    - path: "electron-app/src/renderer/components/knowledge/editor-toolbar.tsx"
      provides: "Table insert button and contextual table controls"
      contains: "insertTable"
  key_links:
    - from: "editor-toolbar.tsx"
      to: "editor (TipTap)"
      via: "editor.chain().focus().insertTable/addColumnAfter/deleteColumn/addRowAfter/deleteRow/deleteTable"
      pattern: "insertTable|addColumnAfter|deleteColumn|addRowAfter|deleteRow"
---

<objective>
Add table insert button and contextual table controls (add/remove rows and columns, delete table) to the editor toolbar.

Purpose: Covers requirement EDIT-05 (tables with resizable columns, add/remove rows and columns).
Output: Updated editor-toolbar.tsx with table section.
</objective>

<execution_context>
@C:\Users\samng\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\samng\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-rich-text-editor-core/03-RESEARCH.md
@.planning/phases/03-rich-text-editor-core/03-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add table insert button and contextual table controls to toolbar</name>
  <files>
    electron-app/src/renderer/components/knowledge/editor-toolbar.tsx
  </files>
  <action>
    Read the current editor-toolbar.tsx. Replace the table placeholder comment with:

    1. **Table Insert Button** (in a new separator + group):
       - Import icons: Table2, Plus, Minus, Trash2, Rows3, Columns3 from lucide-react (or similar table-related icons)
       - "Insert Table" button: `editor.chain().focus().insertTable({ rows: 3, cols: 3, withHeaderRow: true }).run()`
       - Use Table2 icon, title "Insert table (3x3)"

    2. **Contextual Table Controls** (only visible when cursor is inside a table):
       - Check `editor.isActive('table')` to conditionally render these controls
       - Wrap in a group with a separator before it
       - Add column after: `editor.chain().focus().addColumnAfter().run()` -- icon: column with plus
       - Delete column: `editor.chain().focus().deleteColumn().run()` -- icon: column with minus
       - Add row after: `editor.chain().focus().addRowAfter().run()` -- icon: row with plus
       - Delete row: `editor.chain().focus().deleteRow().run()` -- icon: row with minus
       - Delete table: `editor.chain().focus().deleteTable().run()` -- icon: Trash2, title "Delete table"
       - Toggle header row: `editor.chain().focus().toggleHeaderRow().run()` -- optional nice-to-have

    3. For icons, use lucide-react. If specific row/column icons are not available, use:
       - Columns3 with a Plus overlay or just use Plus/Minus icons with descriptive titles
       - Alternative: Use small text labels like "Col+" "Col-" "Row+" "Row-" alongside icons
       - Keep it simple: ToolbarButton with descriptive title attributes is sufficient

    Keep all existing toolbar sections intact. Keep placeholder comment for Plan 03-04 (link, font, color).
  </action>
  <verify>
    - `cd electron-app && npx tsc --noEmit` passes
    - editor-toolbar.tsx contains insertTable, addColumnAfter, deleteColumn, addRowAfter, deleteRow calls
    - Table controls conditionally render based on editor.isActive('table')
  </verify>
  <done>
    Toolbar has table insert button (3x3 with header row). When cursor is in a table, contextual controls appear for adding/removing rows and columns and deleting the table. Table resize works via CSS from plan 03-01.
  </done>
</task>

</tasks>

<verification>
- `cd electron-app && npx tsc --noEmit` passes
- Insert table creates a 3x3 table with header row
- Contextual controls appear only when cursor is inside a table
- Table columns are resizable (via Table.configure({ resizable: true }) from extension factory + CSS)
</verification>

<success_criteria>
- EDIT-05: User can insert tables, resize columns, and add/remove rows and columns
- Table controls are contextual (only shown when in a table)
- Delete table option available
</success_criteria>

<output>
After completion, create `.planning/phases/03-rich-text-editor-core/03-03-SUMMARY.md`
</output>
