---
phase: 03-rich-text-editor-core
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - electron-app/src/renderer/components/knowledge/editor-toolbar.tsx
autonomous: true

must_haves:
  truths:
    - "User can select heading level H1-H6 or Paragraph from a dropdown"
    - "User can toggle bullet list, numbered list, and checklist from toolbar"
    - "User can insert a code block from toolbar"
    - "User can indent and outdent paragraphs/headings from toolbar"
  artifacts:
    - path: "electron-app/src/renderer/components/knowledge/editor-toolbar.tsx"
      provides: "Heading dropdown, list buttons, code block button, indent controls"
      contains: "toggleHeading"
  key_links:
    - from: "editor-toolbar.tsx"
      to: "editor (TipTap)"
      via: "editor.chain().focus().toggleHeading/toggleBulletList/toggleTaskList/toggleCodeBlock"
      pattern: "toggleHeading|toggleBulletList|toggleOrderedList|toggleTaskList|toggleCodeBlock"
---

<objective>
Add heading dropdown (H1-H6 + Paragraph), bullet list, numbered list, checklist, code block, and indent/outdent controls to the editor toolbar.

Purpose: Covers requirements EDIT-02 (headings), EDIT-03 (lists + indentation), EDIT-04 (checklists), EDIT-06 (code blocks).
Output: Updated editor-toolbar.tsx with 3 new toolbar sections.
</objective>

<execution_context>
@C:\Users\samng\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\samng\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-rich-text-editor-core/03-RESEARCH.md
@.planning/phases/03-rich-text-editor-core/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add heading dropdown, list buttons, code block, and indent controls to toolbar</name>
  <files>
    electron-app/src/renderer/components/knowledge/editor-toolbar.tsx
  </files>
  <action>
    Read the current editor-toolbar.tsx created in plan 03-01. Add the following toolbar sections after the basic formatting group, replacing the placeholder comments:

    1. **Heading Dropdown** (after basic formatting separator):
       - Import Popover, PopoverTrigger, PopoverContent from `@/components/ui/popover`
       - Import icons: Heading, ChevronDown, Pilcrow from lucide-react
       - Create a helper function `getCurrentHeadingLabel(editor: Editor): string` that returns "Heading 1"-"Heading 6" if a heading is active, or "Paragraph" otherwise. Check with `editor.isActive('heading', { level: N })` for N=1..6.
       - Render a Popover with trigger button showing current heading icon + label + chevron-down
       - PopoverContent: list of 8 items (Paragraph + H1-H6), each a button that calls:
         - Paragraph: `editor.chain().focus().setParagraph().run()`
         - Heading N: `editor.chain().focus().toggleHeading({ level: N as 1|2|3|4|5|6 }).run()`
       - Each heading option shows a preview of the font size: H1 text-xl font-bold, H2 text-lg font-bold, H3 text-base font-semibold, H4 text-sm font-semibold, H5 text-xs font-semibold, H6 text-xs font-medium
       - Active heading has `bg-primary/10` background
       - Close popover on selection (use state or Popover onOpenChange)

    2. **Separator** then **List + Checklist group**:
       - Import icons: List, ListOrdered, ListChecks from lucide-react
       - Bullet list button: `editor.chain().focus().toggleBulletList().run()`, active: `editor.isActive('bulletList')`
       - Numbered list button: `editor.chain().focus().toggleOrderedList().run()`, active: `editor.isActive('orderedList')`
       - Checklist button: `editor.chain().focus().toggleTaskList().run()`, active: `editor.isActive('taskList')`

    3. **Separator** then **Code Block button**:
       - Import icon: Code2 from lucide-react
       - Code block button: `editor.chain().focus().toggleCodeBlock().run()`, active: `editor.isActive('codeBlock')`

    4. **Separator** then **Indent/Outdent group**:
       - Import icons: IndentIncrease, IndentDecrease from lucide-react (or Indent, Outdent)
       - Indent button: `(editor.chain().focus() as any).indent().run()` -- use `as any` because custom Indent extension commands are not in TipTap type system (see research pitfall 7)
       - Outdent button: `(editor.chain().focus() as any).outdent().run()`

    Keep all existing toolbar sections (undo/redo, basic formatting) intact. Keep the placeholder comments for Plan 03-03 (table) and 03-04 (link, font, color).
  </action>
  <verify>
    - `cd electron-app && npx tsc --noEmit` passes
    - editor-toolbar.tsx contains toggleHeading, toggleBulletList, toggleOrderedList, toggleTaskList, toggleCodeBlock calls
    - Heading dropdown uses Popover component
    - Indent/outdent use `as any` pattern
  </verify>
  <done>
    Toolbar has heading dropdown (Paragraph + H1-H6), bullet list, numbered list, checklist, code block, and indent/outdent buttons. All buttons show active state. Heading dropdown shows current heading level.
  </done>
</task>

</tasks>

<verification>
- `cd electron-app && npx tsc --noEmit` passes
- Heading dropdown renders with 7 options (Paragraph + H1-H6)
- List buttons toggle their respective list types
- Code block button toggles code block
- Indent/outdent work via custom extension commands
</verification>

<success_criteria>
- EDIT-02: Heading dropdown provides H1-H6 + Paragraph selection
- EDIT-03: Bullet list and numbered list buttons work
- EDIT-04: Checklist/task list button works
- EDIT-06: Code block toggle button works
- Indent/outdent controls available
</success_criteria>

<output>
After completion, create `.planning/phases/03-rich-text-editor-core/03-02-SUMMARY.md`
</output>
