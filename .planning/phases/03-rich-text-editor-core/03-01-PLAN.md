---
phase: 03-rich-text-editor-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - electron-app/src/renderer/components/knowledge/editor-types.ts
  - electron-app/src/renderer/components/knowledge/editor-extensions.ts
  - electron-app/src/renderer/components/knowledge/editor-styles.css
  - electron-app/src/renderer/components/knowledge/editor-toolbar.tsx
  - electron-app/src/renderer/components/knowledge/document-editor.tsx
autonomous: true

must_haves:
  truths:
    - "DocumentEditor renders with a toolbar and editable content area"
    - "Bold, italic, underline, and strikethrough toggles work from toolbar buttons"
    - "Undo and redo buttons work"
    - "Text alignment buttons (left, center, right, justify) work"
    - "Highlight (background color) can be applied to selected text"
  artifacts:
    - path: "electron-app/src/renderer/components/knowledge/editor-types.ts"
      provides: "TypeScript interfaces for DocumentEditor props and toolbar"
    - path: "electron-app/src/renderer/components/knowledge/editor-extensions.ts"
      provides: "Extension factory function with ALL Phase 3 extensions configured"
      exports: ["createDocumentExtensions"]
    - path: "electron-app/src/renderer/components/knowledge/editor-styles.css"
      provides: "ProseMirror CSS overrides for tables, task lists, code blocks, resize handles"
    - path: "electron-app/src/renderer/components/knowledge/editor-toolbar.tsx"
      provides: "Toolbar component with text formatting group (bold/italic/underline/strike/code), alignment, highlight, undo/redo"
      exports: ["EditorToolbar"]
    - path: "electron-app/src/renderer/components/knowledge/document-editor.tsx"
      provides: "Main DocumentEditor component composing toolbar + EditorContent + status bar"
      exports: ["DocumentEditor"]
  key_links:
    - from: "document-editor.tsx"
      to: "editor-extensions.ts"
      via: "createDocumentExtensions() called in useEditor"
      pattern: "createDocumentExtensions"
    - from: "document-editor.tsx"
      to: "editor-toolbar.tsx"
      via: "EditorToolbar rendered with editor prop"
      pattern: "<EditorToolbar"
    - from: "document-editor.tsx"
      to: "editor-styles.css"
      via: "CSS import at top of file"
      pattern: "import.*editor-styles"
---

<objective>
Set up the DocumentEditor component foundation with npm packages, extension configuration factory, CSS overrides, toolbar shell with basic text formatting, and the main editor component.

Purpose: This is the base layer for the rich text editor. All subsequent plans (02-04) add toolbar sections and features on top of this foundation. The extension factory configures ALL extensions upfront (including those for plans 02-04) so later plans only need to add toolbar UI, not extension wiring.

Output: A working DocumentEditor component with bold/italic/underline/strikethrough/alignment/highlight/undo/redo toolbar, ready for additional toolbar sections.
</objective>

<execution_context>
@C:\Users\samng\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\samng\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-rich-text-editor-core/03-RESEARCH.md
@electron-app/src/renderer/components/editor/RichTextEditor.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install packages and create extension factory, types, and CSS</name>
  <files>
    electron-app/src/renderer/components/knowledge/editor-types.ts
    electron-app/src/renderer/components/knowledge/editor-extensions.ts
    electron-app/src/renderer/components/knowledge/editor-styles.css
  </files>
  <action>
**Step 1: Install npm packages**

```bash
cd electron-app
npm install @tiptap/extension-code-block-lowlight lowlight @tiptap/extension-character-count
```

**Step 2: Create `editor-types.ts`**

Define interfaces:
- `DocumentEditorProps`: content (TipTap JSON object or null), onUpdate (callback receiving TipTap JSON), placeholder (string), readOnly (boolean), className (string), all optional except content
- `EditorToolbarProps`: editor (TipTap Editor instance, required)
- `EditorStatusBarProps`: editor (TipTap Editor instance, required)

**Step 3: Create `editor-extensions.ts`**

Create a factory function `createDocumentExtensions(options?: { placeholder?: string })` that returns ALL extensions for the knowledge base editor. Configure ALL extensions now (even ones whose toolbar buttons come in later plans) so plans 02-04 only add UI.

Extensions to include:
- `StarterKit.configure({ heading: { levels: [1,2,3,4,5,6] }, codeBlock: false })` -- CRITICAL: disable codeBlock to avoid conflict with CodeBlockLowlight
- `Underline`
- `TextStyle`
- `FontFamily`
- Custom `FontSize` extension -- copy the exact implementation from `RichTextEditor.tsx` (lines 34-64). It extends TextStyle with a fontSize global attribute that parses/renders CSS font-size.
- Custom `Indent` extension -- copy the exact implementation from `RichTextEditor.tsx` (lines 67-141). It adds margin-left indentation to paragraph and heading nodes.
- `Color`
- `Highlight.configure({ multicolor: true })`
- `TextAlign.configure({ types: ['heading', 'paragraph'] })`
- `Link.configure({ openOnClick: false, HTMLAttributes: { class: 'text-primary underline cursor-pointer' } })`
- `Table.configure({ resizable: true, HTMLAttributes: { class: 'border-collapse border border-border w-full' } })`
- `TableRow`
- `TableCell.configure({ HTMLAttributes: { class: 'border border-border p-2' } })`
- `TableHeader.configure({ HTMLAttributes: { class: 'border border-border p-2 bg-muted font-semibold' } })`
- `TaskList.configure({ HTMLAttributes: { class: 'not-prose' } })`
- `TaskItem.configure({ HTMLAttributes: { class: 'flex items-start gap-2' }, nested: true })`
- `CodeBlockLowlight.configure({ lowlight, defaultLanguage: 'plaintext', HTMLAttributes: { class: 'rounded-md bg-muted p-4 font-mono text-sm overflow-x-auto' } })` -- use `import { common, createLowlight } from 'lowlight'` and `const lowlight = createLowlight(common)` (v3 syntax, NOT v2)
- `CharacterCount`
- `Placeholder.configure({ placeholder: options?.placeholder || 'Start writing...' })`

Also export constants: `COLORS` array, `HIGHLIGHT_COLORS` array, `FONT_SIZES` array, `FONT_FAMILIES` array, `DEFAULT_FONT_FAMILY` -- copy these from `RichTextEditor.tsx` (lines 305-371).

**Step 4: Create `editor-styles.css`**

Import highlight.js theme: `@import 'highlight.js/styles/github-dark.css';`

Add ProseMirror CSS overrides:
- Table resize handle styles (copy from RichTextEditor.tsx editorProps.attributes.class, lines 1018-1026, but as proper CSS selectors instead of Tailwind arbitrary variants)
- Task list checkbox styling: `ul[data-type=taskList]` remove list-style, set padding-left 0. Task list `li` flex items-start. Checkbox input margin-top, height/width 1rem, accent-color primary.
- Code block pre/code styling: ensure `pre` has `overflow-x: auto` and proper padding
- Selected cell highlight: `.selectedCell { background: hsl(var(--primary) / 0.1) }`
- Placeholder styling: `.ProseMirror p.is-editor-empty:first-child::before` with content from data-placeholder, color muted-foreground, float left, pointer-events none
  </action>
  <verify>
Run `cd electron-app && npm ls @tiptap/extension-code-block-lowlight lowlight @tiptap/extension-character-count` to confirm packages installed.
Run `cd electron-app && npx tsc --noEmit` to confirm no TypeScript errors in the new files.
  </verify>
  <done>Three new files exist with zero TypeScript errors. All 20+ TipTap extensions configured in factory function. CSS covers tables, task lists, code blocks, and resize handles.</done>
</task>

<task type="auto">
  <name>Task 2: Create EditorToolbar and DocumentEditor components with basic formatting</name>
  <files>
    electron-app/src/renderer/components/knowledge/editor-toolbar.tsx
    electron-app/src/renderer/components/knowledge/document-editor.tsx
  </files>
  <action>
**Step 1: Create `editor-toolbar.tsx`**

Build the `EditorToolbar` component that receives `editor: Editor` as a prop.

Create a reusable `ToolbarButton` component (same pattern as RichTextEditor.tsx lines 377-398): button with onClick, isActive highlight, disabled state, title tooltip, children slot. Use the same Tailwind classes: `p-1.5 rounded hover:bg-muted transition-colors`, active state `bg-muted text-primary`.

Toolbar layout: `<div className="flex flex-wrap items-center gap-1 p-2 border-b bg-muted/30">` with logical groups separated by `border-r pr-2` dividers.

For Plan 01, include these toolbar groups:

1. **Undo/Redo group**: Undo button (Undo icon, `editor.chain().focus().undo().run()`, disabled when `!editor.can().undo()`), Redo button (same pattern).

2. **Text formatting group**: Bold (Ctrl+B), Italic (Ctrl+I), Underline (Ctrl+U), Strikethrough, Inline Code -- each toggles its respective mark. Show isActive state.

3. **Text color group**: Text color popover (Palette icon + ChevronDown) with COLORS grid (6 columns) and "Reset color" button. Highlight popover (Highlighter icon + ChevronDown) with HIGHLIGHT_COLORS grid (4 columns) and "Remove highlight" button. Use Radix Popover from `@/components/ui/popover`.

4. **Alignment group**: AlignLeft, AlignCenter, AlignRight, AlignJustify buttons using `editor.chain().focus().setTextAlign('left'|'center'|'right'|'justify').run()`.

Import icons from lucide-react: Bold, Italic, Underline as UnderlineIcon, Strikethrough, Code, AlignLeft, AlignCenter, AlignRight, AlignJustify, Highlighter, Palette, ChevronDown, Undo, Redo.

Import COLORS, HIGHLIGHT_COLORS from `./editor-extensions`.
Import Popover, PopoverContent, PopoverTrigger from `@/components/ui/popover`.
Import cn from `@/lib/utils`.

Export `EditorToolbar` and `ToolbarButton` (ToolbarButton will be reused by plans 02-04).

**Step 2: Create `document-editor.tsx`**

Build the `DocumentEditor` component.

Props from `DocumentEditorProps` in editor-types.ts. Key props:
- `content`: TipTap JSON object or null (NOT HTML string -- this editor uses JSON format from the start for Phase 4 compatibility)
- `onUpdate`: callback receiving TipTap JSON object (debounced)
- `readOnly`: boolean
- `placeholder`: string
- `className`: string

Implementation:
1. Import `editor-styles.css` at top of file
2. Use `useEditor` hook with `extensions: createDocumentExtensions({ placeholder })`, `content: content`, `editable: !readOnly`
3. Set `editorProps.attributes.class` with prose styles similar to RichTextEditor.tsx but WITHOUT max-height (knowledge base documents can be long): `prose prose-sm max-w-none focus:outline-none min-h-[300px] p-4`
4. Set `editorProps.attributes.style` with `font-family: ${DEFAULT_FONT_FAMILY}`
5. `onUpdate` callback: debounce with 300ms, call `onUpdate` with `editor.getJSON()` (NOT getHTML -- JSON format per project decision)
6. Handle external content changes: track with ref, update via `editor.commands.setContent(content)` when content prop changes (same pattern as RichTextEditor.tsx lines 1131-1148)
7. Handle readOnly changes: `editor.setEditable(!readOnly)` in useEffect

Render structure:
```tsx
<div className={cn('border border-input rounded-lg overflow-hidden bg-background flex flex-col', className)}>
  {!readOnly && <EditorToolbar editor={editor} />}
  <div className="flex-1 overflow-y-auto">
    <EditorContent editor={editor} />
  </div>
</div>
```

Show a loading skeleton when editor is null (same pattern as RichTextEditor.tsx lines 1178-1183).

Export `DocumentEditor` as named export and default export.

Do NOT include: heading dropdown, list buttons, table controls, link dialog, font controls, word count bar. Those come in plans 02-04.
  </action>
  <verify>
Run `cd electron-app && npx tsc --noEmit` to confirm no TypeScript errors.
Run `cd electron-app && npm run lint` to confirm no lint warnings.
  </verify>
  <done>DocumentEditor renders with toolbar showing bold/italic/underline/strikethrough/code/alignment/color/highlight/undo/redo. Editor accepts TipTap JSON content and emits JSON on update. TypeScript compiles and lint passes.</done>
</task>

</tasks>

<verification>
1. `cd electron-app && npx tsc --noEmit` -- zero errors
2. `cd electron-app && npm run lint` -- zero warnings
3. `npm ls @tiptap/extension-code-block-lowlight lowlight @tiptap/extension-character-count` -- all installed
4. All 5 files exist in `electron-app/src/renderer/components/knowledge/`
</verification>

<success_criteria>
- DocumentEditor component exists and compiles
- Extension factory configures all 20+ extensions (including those for plans 02-04)
- Toolbar shows basic formatting controls (bold, italic, underline, strike, code, alignment, colors, undo/redo)
- Editor uses TipTap JSON format (not HTML)
- CSS file covers table resize, task list, code block, and placeholder styles
- No TypeScript errors, no lint warnings
</success_criteria>

<output>
After completion, create `.planning/phases/03-rich-text-editor-core/03-01-SUMMARY.md`
</output>
