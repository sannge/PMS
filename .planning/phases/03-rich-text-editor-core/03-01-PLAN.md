---
phase: 03-rich-text-editor-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - electron-app/src/renderer/components/knowledge/editor-types.ts
  - electron-app/src/renderer/components/knowledge/editor-extensions.ts
  - electron-app/src/renderer/components/knowledge/editor-styles.css
  - electron-app/src/renderer/components/knowledge/editor-toolbar.tsx
  - electron-app/src/renderer/components/knowledge/document-editor.tsx
autonomous: true

must_haves:
  truths:
    - "DocumentEditor renders a TipTap editor with editable content area"
    - "Toolbar shows bold, italic, underline, strikethrough buttons that toggle formatting"
    - "Editor outputs TipTap JSON (not HTML) via onChange callback"
    - "All TipTap extensions are configured in a single factory function"
  artifacts:
    - path: "electron-app/src/renderer/components/knowledge/editor-types.ts"
      provides: "TypeScript interfaces for DocumentEditor props and toolbar props"
      contains: "DocumentEditorProps"
    - path: "electron-app/src/renderer/components/knowledge/editor-extensions.ts"
      provides: "Extension factory with ALL extensions configured upfront"
      exports: ["createDocumentExtensions", "COLORS", "HIGHLIGHT_COLORS", "FONT_SIZES", "FONT_FAMILIES", "DEFAULT_FONT_FAMILY"]
    - path: "electron-app/src/renderer/components/knowledge/editor-styles.css"
      provides: "ProseMirror CSS overrides, table resize, task list, code block, highlight.js theme"
      contains: ".ProseMirror"
    - path: "electron-app/src/renderer/components/knowledge/editor-toolbar.tsx"
      provides: "EditorToolbar component with basic text formatting section"
      exports: ["EditorToolbar"]
    - path: "electron-app/src/renderer/components/knowledge/document-editor.tsx"
      provides: "Main DocumentEditor component composing toolbar + editor + status bar"
      exports: ["DocumentEditor"]
  key_links:
    - from: "document-editor.tsx"
      to: "editor-extensions.ts"
      via: "createDocumentExtensions() call in useEditor"
      pattern: "createDocumentExtensions"
    - from: "document-editor.tsx"
      to: "editor-toolbar.tsx"
      via: "EditorToolbar component receiving editor prop"
      pattern: "EditorToolbar.*editor"
    - from: "editor-extensions.ts"
      to: "@tiptap/extension-code-block-lowlight"
      via: "CodeBlockLowlight.configure with lowlight v3"
      pattern: "createLowlight"
---

<objective>
Install new TipTap packages, create the knowledge base editor foundation: extension factory with ALL extensions configured upfront, TypeScript types, ProseMirror/highlight.js CSS, toolbar with basic text formatting (bold/italic/underline/strikethrough + undo/redo), and the DocumentEditor shell component.

Purpose: This is the foundation that all subsequent Phase 3 plans build on. The extension factory configures every extension once; later plans only add toolbar UI sections.
Output: 5 new files in `knowledge/` directory, 3 new npm packages installed.
</objective>

<execution_context>
@C:\Users\samng\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\samng\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-rich-text-editor-core/03-RESEARCH.md
@electron-app/src/renderer/components/editor/RichTextEditor.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install packages, create types, extension factory, and CSS</name>
  <files>
    electron-app/src/renderer/components/knowledge/editor-types.ts
    electron-app/src/renderer/components/knowledge/editor-extensions.ts
    electron-app/src/renderer/components/knowledge/editor-styles.css
  </files>
  <action>
    1. Install new packages:
       ```bash
       cd electron-app && npm install @tiptap/extension-code-block-lowlight lowlight @tiptap/extension-character-count
       ```

    2. Create `knowledge/` directory: `electron-app/src/renderer/components/knowledge/`

    3. Create `editor-types.ts` with interfaces:
       - `DocumentEditorProps`: { content?: object; onChange?: (json: object) => void; editable?: boolean; placeholder?: string; className?: string }
       - `EditorToolbarProps`: { editor: Editor }
       - Export `ToolbarSection` type for grouping toolbar items

    4. Create `editor-extensions.ts`:
       - Copy FontSize extension from RichTextEditor.tsx lines 34-64 (EXACT copy)
       - Copy Indent extension from RichTextEditor.tsx lines 67-141 (EXACT copy, including INDENT_STEP=40, MAX_INDENT_LEVEL=8)
       - Copy ALL constants from RichTextEditor.tsx: COLORS (60 items, lines 305-326), HIGHLIGHT_COLORS (40 items, lines 328-349), FONT_SIZES (4 items, lines 351-356), FONT_FAMILIES (10 items, lines 358-369), DEFAULT_FONT_FAMILY (line 371)
       - Create `createDocumentExtensions(options?: { placeholder?: string })` factory returning array of ALL extensions:
         - StarterKit.configure({ heading: { levels: [1,2,3,4,5,6] }, codeBlock: false }) -- CRITICAL: codeBlock: false to avoid conflict with CodeBlockLowlight
         - Underline
         - TextStyle, FontFamily, FontSize (custom), Indent (custom)
         - Color, Highlight.configure({ multicolor: true })
         - TextAlign.configure({ types: ['heading', 'paragraph'] })
         - Link.configure({ openOnClick: false, HTMLAttributes: { class: 'text-primary underline cursor-pointer' } })
         - Table.configure({ resizable: true, HTMLAttributes: { class: 'border-collapse border border-border w-full' } })
         - TableRow, TableCell.configure({ HTMLAttributes: { class: 'border border-border p-2' } }), TableHeader.configure({ HTMLAttributes: { class: 'border border-border p-2 bg-muted font-semibold' } })
         - TaskList.configure({ HTMLAttributes: { class: 'not-prose' } }), TaskItem.configure({ HTMLAttributes: { class: 'flex items-start gap-2' }, nested: true })
         - CodeBlockLowlight.configure({ lowlight: createLowlight(common), defaultLanguage: 'plaintext', HTMLAttributes: { class: 'rounded-md bg-muted p-4 font-mono text-sm overflow-x-auto' } })
         - CharacterCount
         - Placeholder.configure({ placeholder: options?.placeholder || 'Start writing...' })
       - Use lowlight v3 syntax: `import { common, createLowlight } from 'lowlight'`

    5. Create `editor-styles.css` with:
       - Import highlight.js theme: use `@import 'highlight.js/styles/github-dark.css';` at top of file
       - ProseMirror base styles: `.ProseMirror { outline: none; min-height: 300px; padding: 1rem; font-family: Arial, sans-serif; }` and `.ProseMirror p { margin: 0.5em 0; }`
       - Heading styles: h1 through h6 with decreasing font sizes (2em, 1.5em, 1.25em, 1.1em, 1em, 0.9em) and font-weight: 600
       - Table resize: `.ProseMirror .column-resize-handle { background-color: hsl(var(--primary)); width: 2px; position: absolute; right: -1px; top: 0; bottom: 0; pointer-events: none; }` and `.ProseMirror.resize-cursor { cursor: col-resize; }`
       - Task list checkbox: `ul[data-type="taskList"] { list-style: none; padding-left: 0; }`, `ul[data-type="taskList"] li { display: flex; align-items: flex-start; gap: 0.5rem; }`, `ul[data-type="taskList"] input[type="checkbox"] { margin-top: 0.25rem; height: 1rem; width: 1rem; accent-color: hsl(var(--primary)); cursor: pointer; }`
       - Code block: `.ProseMirror pre { background: hsl(var(--muted)); border-radius: 0.375rem; padding: 1rem; overflow-x: auto; }` and `.ProseMirror pre code { font-family: ui-monospace, monospace; font-size: 0.875rem; }`
       - List styles: `.ProseMirror ul { list-style: disc; padding-left: 1.5rem; }` and `.ProseMirror ol { list-style: decimal; padding-left: 1.5rem; }`
       - Blockquote: `.ProseMirror blockquote { border-left: 3px solid hsl(var(--border)); padding-left: 1rem; color: hsl(var(--muted-foreground)); }`
       - Placeholder: `.ProseMirror p.is-editor-empty:first-child::before { content: attr(data-placeholder); color: hsl(var(--muted-foreground)); opacity: 0.5; pointer-events: none; float: left; height: 0; }`
       - Link: `.ProseMirror a { color: hsl(var(--primary)); text-decoration: underline; cursor: pointer; }`
  </action>
  <verify>
    - `cd electron-app && npm ls @tiptap/extension-code-block-lowlight lowlight @tiptap/extension-character-count` shows all 3 installed
    - `npx tsc --noEmit --pretty` on editor-types.ts and editor-extensions.ts has no type errors
    - All 3 files exist with correct exports
  </verify>
  <done>
    Extension factory exports createDocumentExtensions() with all 18+ extensions configured. Constants (COLORS, HIGHLIGHT_COLORS, FONT_SIZES, FONT_FAMILIES, DEFAULT_FONT_FAMILY) are exported. CSS covers ProseMirror, tables, task lists, code blocks, and highlight.js theme. TypeScript interfaces defined.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create EditorToolbar and DocumentEditor components</name>
  <files>
    electron-app/src/renderer/components/knowledge/editor-toolbar.tsx
    electron-app/src/renderer/components/knowledge/document-editor.tsx
  </files>
  <action>
    1. Create `editor-toolbar.tsx`:
       - Import Editor from @tiptap/react, lucide-react icons (Bold, Italic, Underline, Strikethrough, Undo2, Redo2)
       - Import EditorToolbarProps from editor-types
       - Create ToolbarButton helper component matching the pattern from RichTextEditor.tsx lines 377-398: button with cn(), p-1.5 rounded hover:bg-muted, isActive && 'bg-muted text-primary', disabled && 'opacity-50 cursor-not-allowed', title prop for tooltip
       - Export `EditorToolbar({ editor }: EditorToolbarProps)` component:
         - Container: `<div className="flex flex-wrap items-center gap-0.5 p-2 border-b bg-muted/30">`
         - Undo/Redo group: Undo2 button (editor.chain().focus().undo().run()), Redo2 button (editor.chain().focus().redo().run()), with disabled state from editor.can().undo()/redo()
         - Separator: `<div className="w-px h-6 bg-border mx-1" />` between groups
         - Basic formatting group: Bold (Ctrl+B), Italic (Ctrl+I), Underline (Ctrl+U), Strikethrough buttons
         - Each button uses `editor.isActive('bold')` etc. for active state
         - Each button calls `editor.chain().focus().toggleBold().run()` etc.
       - Add comment placeholders for sections that will be added in plans 03-02, 03-03, 03-04:
         ```
         {/* Heading dropdown - Plan 03-02 */}
         {/* List buttons - Plan 03-02 */}
         {/* Table controls - Plan 03-03 */}
         {/* Link, Font, Color controls - Plan 03-04 */}
         ```

    2. Create `document-editor.tsx`:
       - Import useEditor, EditorContent from @tiptap/react
       - Import useCallback, useRef from react
       - Import createDocumentExtensions from ./editor-extensions
       - Import EditorToolbar from ./editor-toolbar
       - Import DocumentEditorProps from ./editor-types
       - Import the CSS: `import './editor-styles.css'`
       - Export `DocumentEditor({ content, onChange, editable = true, placeholder, className }: DocumentEditorProps)`:
         - Create editor with useEditor({ extensions: createDocumentExtensions({ placeholder }), content: content || undefined, editable, onUpdate: debounced onChange callback })
         - Debounce onUpdate by 300ms using useRef + setTimeout pattern (NOT importing lodash). On each onUpdate, clear previous timeout, set new 300ms timeout that calls onChange(editor.getJSON()). Use useRef for timeout ID.
         - Return null if !editor
         - Render structure:
           ```
           <div className={cn("border rounded-lg overflow-hidden bg-background", className)}>
             {editable && <EditorToolbar editor={editor} />}
             <EditorContent editor={editor} className="prose prose-sm max-w-none" />
             {/* Status bar placeholder - word count added in Plan 03-04 */}
           </div>
           ```
       - Handle editable prop changes: use useEffect to call editor.setEditable(editable) when prop changes
       - Handle content prop changes: use useEffect to call editor.commands.setContent(content) when content prop changes AND editor is not focused (to avoid overwriting user typing). Check focus with editor.isFocused.
  </action>
  <verify>
    - `cd electron-app && npx tsc --noEmit` passes with no errors in the knowledge/ directory files
    - DocumentEditor component exports correctly
    - EditorToolbar receives Editor prop and renders buttons
  </verify>
  <done>
    DocumentEditor renders with TipTap editor, toolbar with undo/redo and bold/italic/underline/strikethrough. Content changes trigger debounced onChange with JSON output. Editor respects editable prop. Placeholder sections exist for remaining toolbar groups.
  </done>
</task>

</tasks>

<verification>
- All 5 files exist in `electron-app/src/renderer/components/knowledge/`
- `cd electron-app && npx tsc --noEmit` passes
- npm packages installed: @tiptap/extension-code-block-lowlight, lowlight, @tiptap/extension-character-count
- Extension factory configures StarterKit with codeBlock: false (no conflict)
- CSS imports highlight.js theme
</verification>

<success_criteria>
- DocumentEditor component renders TipTap editor with basic formatting toolbar
- Extension factory configures ALL extensions upfront (headings H1-H6, lists, task lists, tables, code blocks, links, fonts, colors, character count)
- Editor outputs JSON format via onChange callback (not HTML)
- CSS handles ProseMirror, table resize, task list checkboxes, code block highlighting, headings
</success_criteria>

<output>
After completion, create `.planning/phases/03-rich-text-editor-core/03-01-SUMMARY.md`
</output>
